<!DOCTYPE html>
<html lang="nl">
<head>
<meta charset="utf-8" />
<title>Sankey AD4 → AD5 Mapping</title>

<link href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;600&display=swap" rel="stylesheet">

<style>
    body {
        margin:0;
        font-family: "Inter", sans-serif;
        background:#f8f8f8;
    }
    #topbar { background:#003b6c; height:8px; width:100%; }
    #header {
        background:white; padding:25px 40px;
        border-bottom:1px solid #ddd;
    }
    #header h1 { margin:0; font-size:26px; font-weight:600; color:#003b6c; }
    #header p { margin:4px 0 0; color:#555; }

    #filterbox {
        padding:15px 40px;
        background:white;
        border-bottom:1px solid #e0e0e0;
        display:flex;
        gap:10px;
        align-items:center;
    }

    #filterbox input {
        width:350px;
        padding:8px 12px;
        border-radius:6px;
        border:1px solid #bbb;
    }
    #filterbox button {
        padding:8px 14px;
        border-radius:6px;
        border:1px solid #bbb;
        background:#f2f2f2;
        cursor:pointer;
    }
    #filterbox button:hover {
        background:#e6e6e6;
    }

    /* tabs */
    #tabs {
        padding:10px 40px;
        background:white;
        border-bottom:1px solid #ddd;
        display:flex;
        gap:8px;
    }
    .tabbtn {
        padding:6px 12px;
        border-radius:4px;
        border:1px solid #bbb;
        background:#f2f2f2;
        cursor:pointer;
    }
    .tabbtn.active {
        background:#003b6c;
        color:white;
        border-color:#003b6c;
    }

    #chart { padding:20px; }

    .tabcontent { display:none; }
    .tabcontent.active { display:block; }

    svg {
        cursor: move;
        background:white;
    }

    .node rect {
        fill-opacity: 0.9;
        shape-rendering: crispEdges;
    }
    .node text {
        pointer-events:none;
        font-size:12px;
        fill:#333;
        font-weight:600;
    }
    .link {
        fill:none;
        stroke-opacity:0.3;
    }
    .link:hover {
        stroke-opacity:0.6;
    }

    @media print {
        @page { size: landscape; margin: 10mm; }
        body * { visibility:hidden; }
        #chart, #chart * { visibility:visible; }
        #chart { position:absolute; left:0; top:0; width:100%; }
        #tabs { display:none; }
        svg { width:100% !important; height:auto !important; }
    }
</style>
</head>

<body>

<div id="topbar"></div>

<div id="header">
    <h1>Areaaldata 4 → Areaaldata 5 (IMBOR) – gesorteerd op AD5-object volledige mapping</h1>
    <p>Interactieve Sankey-weergave – gesorteerd overzicht - versie 0.92 - bronmapping 23-12-2025</p>
</div>

<div id="filterbox">
    <input id="filterInput" placeholder="Zoek in AD4 of AD5…" />
    <button id="resetZoom">Reset zoom</button>
</div>

<div id="tabs">
    <button class="tabbtn active" data-tab="tab-ad5">Gesorteerd op AD5</button>
    <button class="tabbtn" data-tab="tab-ad4">Gesorteerd (+/-) op AD4</button>
</div>

<div id="chart">

    <div id="tab-ad5" class="tabcontent active">
        <svg id="sankey_ad5"></svg>
    </div>

    <div id="tab-ad4" class="tabcontent">
        <svg id="sankey_ad4"></svg>
    </div>

</div>

<script src="https://d3js.org/d3.v5.min.js"></script>
<script src="lib/d3-sankey.min.js"></script>

<script>
var width = 1600;
var height = 7430;
var margin = {top:20, right:50, bottom:20, left:200};
var color = d3.scaleOrdinal(d3.schemeCategory10);

/* tab switching */
document.querySelectorAll(".tabbtn").forEach(btn => {
    btn.addEventListener("click", () => {
        document.querySelectorAll(".tabbtn").forEach(b => b.classList.remove("active"));
        document.querySelectorAll(".tabcontent").forEach(c => c.classList.remove("active"));
        btn.classList.add("active");
        document.getElementById(btn.dataset.tab).classList.add("active");
    });
});

/* generieke sankey builder */
function drawSankey(svgId, csvPath) {

    var svg = d3.select(svgId)
        .attr("width", width + margin.left + margin.right)
        .attr("height", height + margin.top + margin.bottom);

    svg.selectAll("*").remove();

    var outer = svg.append("g")
        .attr("transform", "translate(" + margin.left + "," + margin.top + ")");

    var container = outer.append("g");

    var sankey = d3.sankey()
        .nodeWidth(70)
        .nodePadding(18)
        .extent([[0, 0], [width, height]]);

    var zoom = d3.zoom()
        .scaleExtent([0.5, 4])
        .on("zoom", function() {
            container.attr("transform", d3.event.transform);
        });

    svg.call(zoom).on("dblclick.zoom", null);

    d3.csv(csvPath).then(function(data) {

        const names = Array.from(new Set(data.flatMap(d => [d.source, d.target])));

        const graph = {
            nodes: names.map(n => ({ name:n })),
            links: data.map(d => ({
                source: names.indexOf(d.source),
                target: names.indexOf(d.target),
                value: +d.value || 1,
                mapping: d.mapping || ""
            }))
        };

        sankey(graph);

        var link = container.append("g")
            .selectAll(".link")
            .data(graph.links)
            .enter()
            .append("path")
            .attr("class","link")
            .attr("d",d3.sankeyLinkHorizontal())
            .style("stroke-width",d=>Math.max(1,d.width))
            .style("stroke",d=>{
                const p=d.target.name.split(".");
                return color(p[1]||"default");
            })
            .append("title")
            .text(d=>d.mapping);

        var node = container.append("g")
            .selectAll(".node")
            .data(graph.nodes)
            .enter()
            .append("g")
            .attr("class","node")
            .attr("transform",d=>"translate("+d.x0+","+d.y0+")");

        node.append("rect")
            .attr("height",d=>d.y1-d.y0)
            .attr("width",sankey.nodeWidth())
            .style("fill",d=>{
                const p=d.name.split(".");
                return color(p[1]||"default");
            });

        node.append("text")
            .attr("x",-15)
            .attr("y",d=>(d.y1-d.y0)/2)
            .attr("dy","0.35em")
            .attr("text-anchor","end")
            .text(d=>d.name);

        /* FILTER */
        const filterInput = document.getElementById("filterInput");
        if (filterInput) {
            filterInput.addEventListener("input", function () {
                const q = this.value.toLowerCase();

                node.style("opacity", d =>
                    d.name.toLowerCase().includes(q) ? 1 : 0.15
                );

                link.style("opacity", d =>
                    d.source.name.toLowerCase().includes(q) ||
                    d.target.name.toLowerCase().includes(q) ||
                    (d.mapping && d.mapping.toLowerCase().includes(q))
                        ? 0.6
                        : 0.05
                );
            });
        }
    });
}

/* CSV’s */
drawSankey("#sankey_ad5","mapping-ad4-ad5-sort-ad5.csv");
drawSankey("#sankey_ad4","mapping-ad4-ad5-sort-ad4.csv");
</script>

</body>
</html>